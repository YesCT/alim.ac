<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>
      alim.ac
      Global Drupal Sprint Weekend
    </title>

    <link href="../../css/normalize-ec2a8901.css" rel="stylesheet" type="text/css" />
    <link href="//netdna.bootstrapcdn.com/font-awesome/4.0.3/css/font-awesome.css" rel="stylesheet" type="text/css" />
    <link href="//maxcdn.bootstrapcdn.com/bootstrap/3.3.2/css/bootstrap.min.css" rel="stylesheet" type="text/css" />
    <link href="../../css/main-556e3750.css" rel="stylesheet" type="text/css" />

    <script src="../../js/vendor/modernizr-2.6.1.min-68fdcc99.js" type="text/javascript"></script>
  </head>
  <body class="writes writes_global-drupal-sprint-weekend writes_global-drupal-sprint-weekend_index">
        <!--[if lt IE 7]>
            <p class="chromeframe">You are using an outdated browser. <a href="http://browsehappy.com/">Upgrade your browser today</a> or <a href="http://www.google.com/chromeframe/?redirect=true">install Google Chrome Frame</a> to better experience this site.</p>
        <![endif]-->

    <header>
  <nav role="navigation" class="navbar navbar-default">
    <div class="container">
    
      <div class="navbar-header">
        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
          <span class="sr-only">Toggle navigation</span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand" href="/index.html">alim.ac</a>
      </div>

      <div class="navbar-collapse collapse">
        <ul class="nav navbar-nav">
  <li> <a href="../"><i class="fa fa-pencil"></i> writes</a> </li>
  <li> <a href="../../about/"><i class="fa fa-comment"></i> about</a> </li>
</ul>

      </div>

    </div>
  </nav>
</header>


    <div class="container">
          <article>
    <h1>Global Drupal Sprint Weekend</h1>
    <div class="article-details">
      <p class="lead">
        <i class="fa fa-calendar"></i>
        Saturday, February  1, 2014
      </p>
      <div class="tags">
          <a href="/writes/tags/community/"><i class="fa fa-tag"></i> community</a>
          <a href="/writes/tags/drupal/"><i class="fa fa-tag"></i> drupal</a>
      </div>
    </div>
    <p>On January 26 I participated in <a href="https://groups.drupal.org/node/332998">Drupal Global Sprint Weekend</a>. 
 
This was my second time participating in a sprint during the Global Sprint 
Days (check out this <a href="https://www.lullabot.com/blog/podcasts/global-sprint-days">podcast with Cathy Theys</a> to find out how it all got 
started).</p>

<p>There are a few things that helped make this sprint experience even better this 
year:</p>

<ol>
  <li>I had a specific goal.</li>
  <li>I had local environment ready.</li>
  <li>I read <a href="http://www.genuineinteractive.com/blog-posts/web/helpful-guide-first-sprint/">A Helpful Guide to Your First Drupal Sprint</a>.</li>
</ol>

<p>My goal was to learn more about configuration management in Drupal 8. I actually 
didn’t get to exploring configuration management, but I learned about using 
<a href="https://github.com/drush-ops/drush">drush</a> for automating installation and tear-down of a Drupal site.</p>

<h2 id="local-environment">Local environment</h2>

<p>I had a laptop running OS X 10.8.5 and <a href="http://www.mamp.info/en/index.html">MAMP</a> 2.1.2. You will also need 
<a href="http://git-scm.com">git</a> to be installed to run the <code>git clone</code> commands. My notes will be 
helpful to someone who has gone through installing Drupal via browser, but 
wants to speed up or automate the process on the command line.</p>

<h2 id="set-up-drush">Set up drush</h2>

<p>I had a previous version of drush installed (6.0-dev) but I wanted to use 7.0. 
I used <code>pear</code> to install, so to uninstall the existing drush I used:</p>

<pre class="highlight shell"><code>sudo pear uninstall drush/drush
</code></pre>

<p>Instead of using a package manager, I wanted to run drush directly from a local 
git repository. This would allow me to use different versions of drush easily, 
just by switching to a different branch.</p>

<p>First, create a <code>~/bin/</code> directory. Next, clone the drush repository within 
<code>~/bin/</code>:</p>

<pre class="highlight shell"><code>git clone https://github.com/drush-ops/drush.git
</code></pre>

<p>Finally, update <code>.bash_login</code> (or <code>.profile</code> or <code>.bash_profile</code>) to add the 
following two lines:</p>

<pre class="highlight shell"><code><span class="nb">export </span><span class="nv">PATH</span><span class="o">=</span><span class="s2">"~/bin:</span><span class="nv">$PATH</span><span class="s2">"</span> 
<span class="nb">alias </span><span class="nv">drush</span><span class="o">=</span><span class="s2">"~/bin/drush/drush"</span>
</code></pre>

<p>The first allows me to execute scripts located in my <code>~/bin/</code> directory. 
The second adds an alias to the drush executable. I reloaded my shell:</p>

<pre class="highlight shell"><code>. ~/.bash_login 
</code></pre>

<p>and now I was ready to use drush:</p>

<pre class="highlight shell"><code>drush --version
 Drush Version   :  7.0-dev
</code></pre>

<p>There are just two <a href="https://github.com/drush-ops/drush#additional-configurations-for-mamp">additional configuration steps</a> to make drush work with 
MAMP. Specify which version of PHP will be used by drush. I added the following 
to <code>.bash_login</code>:</p>

<pre class="highlight shell"><code><span class="nb">export </span><span class="nv">PATH</span><span class="o">=</span><span class="s2">"/Applications/MAMP/Library/bin:/Applications/MAMP/bin/php5.4/bin:</span><span class="nv">$PATH</span><span class="s2">"</span>
</code></pre>

<p>Create a symbolic link to MAMP’s MySQL socket file:</p>

<pre class="highlight shell"><code>sudo mkdir /var/mysql
sudo ln -s /Applications/MAMP/tmp/mysql/mysql.sock /var/mysql/mysql.sock
</code></pre>

<h2 id="site-install-with-drush">Site install with drush</h2>

<p>Get a copy of Drupal 8:</p>

<pre class="highlight shell"><code>git clone --branch 8.x http://git.drupal.org/project/drupal.git
</code></pre>

<p>To install Drupal, use <code>drush site-install</code> or the shorthand <code>drush si</code>. 
First I tried it with an existing (but empty) MySQL database and user (both 
named <code>drupal</code>):</p>

<pre class="highlight shell"><code>drush si --account-pass<span class="o">=</span>admin --db-url<span class="o">=</span>mysql://drupal:drupal@localhost/drupal -y
</code></pre>

<p>Afterward I opened <a href="http://localhost/drupal">http://localhost/drupal</a> in the browser to confirm that 
the installation was successful.</p>

<p>Next, I tried it with root MySQL credentials and created a database on the fly:</p>

<pre class="highlight shell"><code>drush si --account-pass<span class="o">=</span>admin --db-url<span class="o">=</span>mysql://root:root@localhost/mydb -y
</code></pre>

<p>One thing I wanted to do is to use root MySQL credentials to create the new 
database, but also create a MySQL user that is granted rights only to that 
database. The reason why I would like to do this is to keep the sites isolated, 
each with its own MySQL user and database. It does not look like this can be 
done with drush, though.</p>

<h2 id="clean-up">Clean up</h2>

<p>Cleaning up, or “resetting” the site involves more than one command. First, 
remove existing database:</p>

<pre class="highlight shell"><code>drush sql-drop -y
</code></pre>

<p>Next, remove existing installation:</p>

<pre class="highlight shell"><code>sudo rm -rf sites/default
</code></pre>

<p>Finally, restore the sites/default/default.settings.php file:</p>

<pre class="highlight shell"><code>sudo git checkout -- sites/default
</code></pre>

<h2 id="script-it-all-up">Script it all up</h2>

<p>After running the individual commands, it’s time to take it easy and script 
all of these tasks. The following two scripts make install and clean-up easy. 
Copy and save each in the <code>~/bin/</code> directory, as <code>drupal-install</code> and 
<code>drupal-clean</code>.</p>

<p>Then, add the following to your shell profile:</p>

<pre class="highlight shell"><code><span class="nb">source</span> ~/bin/drupal-install
<span class="nb">source</span> ~/bin/drupal-clean
</code></pre>

<h3 id="drupal-install">drupal-install</h3>

<pre class="highlight shell"><code><span class="k">function </span>drupal-install<span class="o">()</span> <span class="o">{</span>
	<span class="c"># If you run this command with an argument, it will be the name of the DB</span>
	<span class="k">if</span> <span class="o">[</span> <span class="nv">$1</span> <span class="o">]</span> ; <span class="k">then
		</span>drush si --account-pass<span class="o">=</span>admin --db-url<span class="o">=</span>mysql://root:root@localhost/<span class="nv">$1</span> -y
	<span class="k">else
		</span>drush si --account-pass<span class="o">=</span>admin --db-url<span class="o">=</span>mysql://root:root@localhost/d8 -y
	<span class="k">fi</span>
<span class="o">}</span>
</code></pre>

<h3 id="drupal-clean">drupal-clean</h3>

<pre class="highlight shell"><code><span class="k">function </span>drupal-clean<span class="o">()</span> <span class="o">{</span>
	<span class="c"># Remove existing database</span>
	drush sql-drop -y;
	<span class="c"># Remove existing install</span>
	sudo rm -rf sites/default;
	<span class="c"># Restore the sites/default/default.settings.php file</span>
	sudo git checkout -- sites/default;
	<span class="c"># Temporarily make the sites/default writable by anyone</span>
	sudo chmod -R 777 sites/default;
	<span class="c"># Ensure the owner is the current user, not root user</span>
	sudo chown -R <span class="sb">`</span>whoami<span class="sb">`</span> sites/default;
	<span class="c"># Now that we own it and can write, change the permissions back to how drupal expects them</span>
	sudo git checkout -- sites/default;
	<span class="c"># But still ensure that we own the folder</span>
	sudo chown -R <span class="sb">`</span>whoami<span class="sb">`</span> sites/default;
<span class="o">}</span>
</code></pre>

<h2 id="other-things-i-learned">Other things I learned</h2>

<p>Even if you have more than two versions of PHP only two will be shown in MAMP 
preferences. To choose a version that isn’t displayed in MAMP preferences, 
temporarily rename or move the other versions out of the 
<code>/Applications/MAMP/bin/php/</code> directory.</p>

<p>I think MAMP is a great tool to start with when setting up a local development 
environment. In the future I will be exploring setting up a <a href="http://www.vagrantup.com">Vagrant</a> box as 
a local environment for Drupal, so that I can more closely approximate a 
production environment.</p>


  </article>

    </div>

    <footer>
  <nav class="navbar navbar-default"> 
    <div class="container">
        <ul class="nav navbar-nav social-nav">
  <li> <a href="https://twitter.com/czaroxiejka"><i class="fa fa-twitter"></i> twitter</a> </li>
  <li> <a href="https://github.com/alimac"><i class="fa fa-github"></i> github</a> </li>
  <li> <a href="../../feed.xml"><i class="fa fa-rss"></i> feed</a> </li>
</ul>
 
      </div>  
    </div>
  </nav>
</footer>


        <script src="//code.jquery.com/jquery-2.1.3.min.js" type="text/javascript"></script>
        <script src="//maxcdn.bootstrapcdn.com/bootstrap/3.3.2/js/bootstrap.min.js" type="text/javascript"></script>
        <script src="../../js/plugins-336f429e.js" type="text/javascript"></script>
        <script src="../../js/main-da39a3ee.js" type="text/javascript"></script>

        <!-- Google Analytics: change UA-XXXXX-X to be your site's ID. -->
        <script>
          (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
          (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
          m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
          })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
          ga('create', 'UA-47875058-1', 'alim.ac');
          ga('send', 'pageview');
        </script>
    </body>
</html>
